---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Dashboard">
  <Navigation currentPath="/dashboard" />

  <main class="pt-20 min-h-screen bg-[--color-cream]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Header -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
        <div>
          <h1 class="font-heading text-3xl text-[--color-espresso]">Dashboard</h1>
          <p class="text-[--color-text-secondary] mt-1">Manage your horoscopes and view insights</p>
        </div>
        <a href="/birth-data" class="btn btn-primary">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          New Horoscope
        </a>
      </div>

      <!-- Quick Stats -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="card p-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-[--color-terracotta]/10 flex items-center justify-center">
              <svg class="w-5 h-5 text-[--color-terracotta]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
            </div>
            <div>
              <p class="text-2xl font-semibold text-[--color-espresso]" id="stat-profiles">0</p>
              <p class="text-xs text-[--color-text-muted]">Saved Profiles</p>
            </div>
          </div>
        </div>

        <div class="card p-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-[--color-sage]/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-[--color-benefic]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
            </div>
            <div>
              <p class="text-2xl font-semibold text-[--color-espresso]" id="stat-predictions">12</p>
              <p class="text-xs text-[--color-text-muted]">Predictions</p>
            </div>
          </div>
        </div>

        <div class="card p-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-[--color-celestial-blue]/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-[--color-celestial-blue]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-[--color-espresso]" id="stat-dasha">-</p>
              <p class="text-xs text-[--color-text-muted]">Current Dasha</p>
            </div>
          </div>
        </div>

        <div class="card p-5">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-[--color-dusty-rose]/20 flex items-center justify-center">
              <svg class="w-5 h-5 text-[--color-dusty-rose]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-[--color-espresso]" id="stat-ruling">-</p>
              <p class="text-xs text-[--color-text-muted]">Day Lord</p>
            </div>
          </div>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Saved Horoscopes -->
        <div class="lg:col-span-2">
          <div class="card">
            <div class="p-6 border-b border-[--color-border]">
              <h2 class="font-heading text-xl text-[--color-espresso]">Saved Horoscopes</h2>
            </div>
            <div id="profiles-list" class="p-6">
              <!-- Empty state -->
              <div id="empty-state" class="text-center py-12">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-[--color-linen] flex items-center justify-center">
                  <svg class="w-8 h-8 text-[--color-taupe]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                </div>
                <h3 class="font-heading text-lg text-[--color-espresso] mb-2">No horoscopes yet</h3>
                <p class="text-sm text-[--color-text-muted] mb-4">Create your first horoscope to get started</p>
                <a href="/birth-data" class="btn btn-primary text-sm">
                  Create Horoscope
                </a>
              </div>

              <!-- Profile cards will be injected here -->
              <div id="profiles-container" class="hidden space-y-4"></div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Current Ruling Planets -->
          <div class="card p-6">
            <h3 class="font-heading text-lg text-[--color-espresso] mb-4">Current Ruling Planets</h3>
            <div class="space-y-3" id="ruling-planets">
              <div class="flex justify-between items-center py-2 border-b border-[--color-border]">
                <span class="text-sm text-[--color-text-secondary]">Day Lord</span>
                <span class="text-sm font-medium text-[--color-espresso]" id="day-lord">-</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-[--color-border]">
                <span class="text-sm text-[--color-text-secondary]">Moon Sign Lord</span>
                <span class="text-sm font-medium text-[--color-espresso]" id="moon-sign-lord">-</span>
              </div>
              <div class="flex justify-between items-center py-2 border-b border-[--color-border]">
                <span class="text-sm text-[--color-text-secondary]">Moon Star Lord</span>
                <span class="text-sm font-medium text-[--color-espresso]" id="moon-star-lord">-</span>
              </div>
              <div class="flex justify-between items-center py-2">
                <span class="text-sm text-[--color-text-secondary]">Ascendant Sign Lord</span>
                <span class="text-sm font-medium text-[--color-espresso]" id="asc-sign-lord">-</span>
              </div>
            </div>
            <p class="text-xs text-[--color-text-muted] mt-4">
              Ruling planets help in timing events and horary predictions
            </p>
          </div>

          <!-- Quick Actions -->
          <div class="card p-6">
            <h3 class="font-heading text-lg text-[--color-espresso] mb-4">Quick Actions</h3>
            <div class="space-y-2">
              <a href="/horary" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[--color-linen] transition-colors group">
                <div class="w-10 h-10 rounded-lg bg-[--color-neutral]/10 flex items-center justify-center">
                  <svg class="w-5 h-5 text-[--color-neutral]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-[--color-espresso] group-hover:text-[--color-terracotta]">KP Number Horary</p>
                  <p class="text-xs text-[--color-text-muted]">Ask a specific question</p>
                </div>
              </a>
              <a href="/transit" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[--color-linen] transition-colors group">
                <div class="w-10 h-10 rounded-lg bg-[--color-celestial-blue]/10 flex items-center justify-center">
                  <svg class="w-5 h-5 text-[--color-celestial-blue]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-[--color-espresso] group-hover:text-[--color-terracotta]">Transit Analysis</p>
                  <p class="text-xs text-[--color-text-muted]">Current planetary transits</p>
                </div>
              </a>
              <a href="/matching" class="flex items-center gap-3 p-3 rounded-lg hover:bg-[--color-linen] transition-colors group">
                <div class="w-10 h-10 rounded-lg bg-[--color-dusty-rose]/10 flex items-center justify-center">
                  <svg class="w-5 h-5 text-[--color-dusty-rose]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-medium text-[--color-espresso] group-hover:text-[--color-terracotta]">Compatibility Matching</p>
                  <p class="text-xs text-[--color-text-muted]">Compare two horoscopes</p>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<script>
  // Day lords mapping
  const dayLords = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn'];

  // Update ruling planets based on current time
  function updateRulingPlanets() {
    const now = new Date();
    const dayIndex = now.getDay();

    // Day lord (simple version)
    const dayLord = dayLords[dayIndex === 0 ? 0 : dayIndex]; // Sunday = 0 = Sun
    document.getElementById('day-lord')!.textContent = dayLord;
    document.getElementById('stat-ruling')!.textContent = dayLord;

    // For demo, show placeholder values for other ruling planets
    // In a real app, these would be calculated based on current planetary positions
    document.getElementById('moon-sign-lord')!.textContent = 'Mercury';
    document.getElementById('moon-star-lord')!.textContent = 'Venus';
    document.getElementById('asc-sign-lord')!.textContent = 'Jupiter';
  }

  // Load saved profiles
  function loadProfiles() {
    const profiles = JSON.parse(localStorage.getItem('savedProfiles') || '[]');
    const container = document.getElementById('profiles-container');
    const emptyState = document.getElementById('empty-state');

    document.getElementById('stat-profiles')!.textContent = profiles.length.toString();

    if (profiles.length === 0) {
      emptyState?.classList.remove('hidden');
      container?.classList.add('hidden');
      return;
    }

    emptyState?.classList.add('hidden');
    container?.classList.remove('hidden');

    container!.innerHTML = profiles.map((profile: any) => `
      <div class="flex items-center justify-between p-4 rounded-lg bg-[--color-linen]/50 hover:bg-[--color-linen] transition-colors">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[--color-terracotta] to-[--color-golden-hour] flex items-center justify-center text-white font-semibold">
            ${profile.name?.charAt(0)?.toUpperCase() || 'U'}
          </div>
          <div>
            <h4 class="font-medium text-[--color-espresso]">${profile.name || 'Unknown'}</h4>
            <p class="text-sm text-[--color-text-muted]">${profile.birthDate || 'No date'} â€¢ ${profile.birthPlace || 'Unknown place'}</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <a href="/chart?id=${profile.id}" class="btn btn-ghost text-sm py-2 px-3">
            View Chart
          </a>
          <button onclick="deleteProfile(${profile.id})" class="p-2 text-[--color-text-muted] hover:text-[--color-malefic] transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
        </div>
      </div>
    `).join('');
  }

  // Delete profile
  (window as any).deleteProfile = function(id: number) {
    if (confirm('Are you sure you want to delete this profile?')) {
      const profiles = JSON.parse(localStorage.getItem('savedProfiles') || '[]');
      const filtered = profiles.filter((p: any) => p.id !== id);
      localStorage.setItem('savedProfiles', JSON.stringify(filtered));
      loadProfiles();
    }
  };

  // Initialize
  updateRulingPlanets();
  loadProfiles();
</script>
